name: Build Dolphin (libretro) on Android

on: [push, pull_request]

env:
  core_id: dolphin_libretro

jobs:
  build-android:
    runs-on: ubuntu-latest
    steps:
    - name: Install dependencies
      run: |
        sudo apt-get update
        sudo apt-get install -y openjdk-17-jdk wget unzip cmake ninja-build
        wget https://dl.google.com/android/repository/android-ndk-r26d-linux.zip
        unzip -q android-ndk-r26d-linux.zip
        echo "ANDROID_NDK_HOME=$PWD/android-ndk-r26d" >> $GITHUB_ENV

    - name: Checkout Dolphin (libretro) repo
      uses: actions/checkout@v6
      with:
        path: ${{ env.core_id }}
        submodules: recursive

    - name: Configure
      run: |
        cd ${{ env.core_id }}
        cmake -B build/android-arm64-v8a \
          -DLIBRETRO=ON \
          -DCMAKE_BUILD_TYPE=Release \
          -DANDROID_ABI=arm64-v8a \
          -DANDROID_PLATFORM=android-26 \
          -DCMAKE_TOOLCHAIN_FILE=$ANDROID_NDK_HOME/build/cmake/android.toolchain.cmake \
          -G Ninja

    - name: Build
      run: |
        cd ${{ env.core_id }}/build/android-arm64-v8a
        ninja -j$(nproc)
